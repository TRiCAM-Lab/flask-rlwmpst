<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>RLWMPST</title>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-firestore.js"></script>

    <!-- Load jquery and other libraries -->
    <script src="lib/jquery-min.js" type="text/javascript"></script>
    <script src="lib/underscore-min.js" type="text/javascript"></script>
    <script src="lib/backbone-min.js" type="text/javascript"></script>
    <script src="lib/d3.v3.min.js" type="text/javascript"></script>

    <!-- Load jsPsych and plugins -->
    <script src="js/jspsych/jspsych.js" type="text/javascript"></script>
    <script
      src="js/jspsych/plugins/jspsych-instructions.js"
      type="text/javascript"
    ></script>
    <script
      src="js/jspsych/plugins/jspsych-html-keyboard-response.js"
      type="text/javascript"
    ></script>
    <script
      src="js/jspsych/plugins/jspsych-image-keyboard-response.js"
      type="text/javascript"
    ></script>
    <script
      src="js/jspsych/plugins/jspsych-feedback-image-keyboard-response.js"
      type="text/javascript"
    ></script>
    <script
      src="js/jspsych/plugins/jspsych-fullscreen.js"
      type="text/javascript"
    ></script>

    <!-- Load Qualtrics iFrame HTML -->
    <!-- <script src="js/qualtrics.js" type="text/javascript"></script> -->

    <!-- Load stylesheets and other utils -->
    <script src="js/utils.js" type="text/javascript"></script>
    <link rel="stylesheet" href="css/jspsych.css" />
    <link rel="stylesheet" href="css/style.css" />
  </head>

  <script>
    // set web app's firebase config
    var firebaseConfig = {
      apiKey: "AIzaSyBElEjhQw7lqHBFr7l_1dks3BkZWDF-5hk",
      authDomain: "rlwmpst.firebaseapp.com",
      databaseURL: "https://rlwmpst.firebaseio.com",
      projectId: "rlwmpst",
      storageBucket: "rlwmpst.appspot.com",
      messagingSenderId: "371606684750",
      appId: "1:371606684750:web:8c1138f154bbaae68eaf1f",
      measurementId: "G-5Y56GL1T6C",
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // call python script to generate task timeline
    var rlwmpst_trials = $.ajax("/get_rlwmpst_trials", {
      type: "GET",
      async: false,
      success: function () {
        console.log("Data successfully loaded.");
      },
    })["responseJSON"];

    /* start the experiment */
    jsPsych.init({
      timeline: rlwmpst_trials,
      on_finish: function () {},
      show_preload_progress_bar: true,
      on_data_update: function (data) {
        console.log(data);

        if (data.trial_index === 1) {
          createFirebaseDocument(data.uniqueId);
          addToFirebase(data);
        }
        if (data.trial_index > 1) {
          addToFirebase(data);
        }
      },
      default_iti: 0,
    });
  </script>
</html>
